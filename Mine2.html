<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Beast Parkour Ultra HD</title>
    <style>
        body { margin: 0; overflow: hidden; background: #4a90e2; font-family: 'Segoe UI', Arial, sans-serif; touch-action: none; }
        canvas { display: block; image-rendering: pixelated; }
        #menu, #deathMenu, #shopMenu, #adminPanel { 
            position: absolute; inset: 0; background: rgba(20, 30, 50, 0.9);
            backdrop-filter: blur(10px); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 200; text-align: center; color: white;
        }
        #deathMenu, #shopMenu, #adminPanel { display: none; }
        .btn { width: 280px; padding: 16px; margin: 10px; font-size: 18px; font-weight: bold; color: white; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; box-shadow: 0 5px #000; text-transform: uppercase; }
        .btn-start { background: #44dd44; }
        .btn-shop { background: #bb44bb; }
        .btn-menu { background: #777; }
        .btn:active { transform: translateY(4px); box-shadow: 0 1px #000; }
        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); color: #00ff00; padding: 12px; border-radius: 5px; z-index: 100; border-left: 5px solid #00ff00; cursor: pointer; }
        
        /* HUD com Contador */
        #abilityHUD { position: absolute; top: 15px; right: 15px; width: 180px; height: 40px; background: rgba(0,0,0,0.8); border: 2px solid #fff; border-radius: 8px; z-index: 100; overflow: hidden; }
        #abilityFill { position: absolute; left: 0; height: 100%; width: 100%; background: #00e5ff; transition: width 0.1s; }
        #abilityText { position: relative; width: 100%; text-align: center; line-height: 40px; font-weight: bold; font-size: 13px; text-shadow: 1px 1px #000; }

        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 50px; box-sizing: border-box; pointer-events: none; }
        .ctrl-btn { width: 80px; height: 80px; background: rgba(255,255,255,0.2); border: 2px solid #fff; border-radius: 50%; pointer-events: auto; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; }
    </style>
</head>
<body>

    <div id="ui" onclick="checkAdmin()">D: <span id="dist">0</span>m | üíé <span id="coins">0</span></div>
    
    <div id="abilityHUD">
        <div id="abilityFill"></div>
        <div id="abilityText">HABILIDADE: 0m</div>
    </div>

    <div id="adminPanel">
        <h1 style="color: #ff4444;">PAINEL ADMIN</h1>
        <button class="btn" style="background: #ff4444;" onclick="toggleGod()">MODO GOD: <span id="godTxt">OFF</span></button>
        <button class="btn" style="background: #ffcc00; color: #000;" onclick="coins += 5000; save();">GANHAR 5000üíé</button>
        <button class="btn" onclick="document.getElementById('adminPanel').style.display='none'">FECHAR</button>
    </div>

    <div id="menu">
        <h1 style="font-size: 40px; text-shadow: 3px 3px #000;">BEAST PARKOUR PRO</h1>
        <button class="btn btn-start" onclick="startGame(true)">JOGAR</button>
        <button class="btn btn-shop" onclick="openShop()">LOJA DE SKINS</button>
    </div>

    <div id="shopMenu">
        <h1>LOJA DE SKINS</h1>
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn" style="background: #3a81a7; width: 120px;" onclick="selectSkin('steve')">STEVE</button>
            <button class="btn" style="background: #00a8ff; width: 120px;" onclick="selectSkin('mrbeast')">MRBEAST</button>
            <button class="btn" style="background: #333; width: 140px;" onclick="selectSkin('herobrine')">HEROBRINE</button>
        </div>
        <button class="btn btn-menu" onclick="document.getElementById('shopMenu').style.display='none'">VOLTAR</button>
    </div>

    <div id="deathMenu">
        <h1 style="color:#ff4444; font-size: 40px;">VOC√ä CAIU!</h1>
        <button class="btn btn-start" id="respawnBtn" onclick="startGame(false)">CHECKPOINT</button>
        <button class="btn btn-menu" onclick="location.reload()">MENU INICIAL</button>
    </div>

    <div class="controls" id="gameControls" style="display:none;">
        <div style="display:flex; gap:20px; pointer-events:auto;">
            <div class="ctrl-btn" id="left">‚Üê</div>
            <div class="ctrl-btn" id="right">‚Üí</div>
        </div>
        <div style="display:flex; gap:20px; pointer-events:auto;">
            <div class="ctrl-btn" style="border-color:#00e5ff;" id="power">W</div>
            <div class="ctrl-btn" id="jump">‚Üë</div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameActive = false, world = {}, cameraX = 0, lastX = 0, adminClicks = 0;
let coins = parseInt(localStorage.getItem("coins")) || 0;
let currentSkin = localStorage.getItem("skin") || "steve";
let godMode = false;

let nextCP = 80;
let checkpointPos = { x: 100, y: 100 };
let hasCP = false;
let lastPowerDist = -200; 

const player = { x: 100, y: 100, vx: 0, vy: 0, w: 30, h: 60, ground: false, jumps: 0 };
const keys = { left: false, right: false };

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();
function save() { localStorage.setItem("coins", coins); localStorage.setItem("skin", currentSkin); }

function checkAdmin() { adminClicks++; if(adminClicks >= 5) { adminClicks = 0; document.getElementById('adminPanel').style.display='flex'; } }
function toggleGod() { godMode = !godMode; document.getElementById('godTxt').innerText = godMode ? "ON" : "OFF"; }
function selectSkin(s) { currentSkin = s; save(); document.getElementById('shopMenu').style.display='none'; }
function openShop() { document.getElementById('shopMenu').style.display='flex'; }

function startGame(fullReset) {
    document.getElementById("menu").style.display = "none";
    document.getElementById("deathMenu").style.display = "none";
    document.getElementById("gameControls").style.display = "flex";
    if(fullReset) {
        world = {}; player.x = 100; player.y = 100; nextCP = 80; hasCP = false; lastPowerDist = -200;
        for(let i=0; i<15; i++) world[`${i*50},${Math.floor(canvas.height*0.75/50)*50}`] = "grass";
    } else {
        player.x = checkpointPos.x; player.y = checkpointPos.y;
    }
    player.vx = 0; player.vy = 0; gameActive = true; loop();
}

function usePowerW() {
    let d = Math.floor(player.x / 50);
    if(currentSkin === 'herobrine' && (d - lastPowerDist) >= 150) {
        for(let i=1; i<=9; i++) {
            let bx = Math.floor((player.x + i*50)/50)*50;
            let by = Math.floor((player.y + 60)/50)*50;
            world[`${bx},${by}`] = "magic";
        }
        lastPowerDist = d;
    }
}

function jumpAction() {
    let d = Math.floor(player.x / 50);
    if(player.ground || godMode) { 
        player.vy = -17; 
        player.jumps = 1; 
    } 
    else if(currentSkin === 'mrbeast' && player.jumps === 1 && (d - lastPowerDist) >= 200) { 
        player.vy = -15; 
        player.jumps = 2; 
        lastPowerDist = d;
    }
}

function drawSkin(x, y) {
    ctx.fillStyle = currentSkin === 'mrbeast' ? "#00a8ff" : (currentSkin === 'herobrine' ? "#333" : "#3a81a7");
    ctx.fillRect(x, y + 20, 30, 40);
    ctx.fillStyle = "#ffdbac"; ctx.fillRect(x + 5, y, 20, 20);
    ctx.fillStyle = "#5d4037"; ctx.fillRect(x + 5, y, 20, 5);
    if(currentSkin === 'herobrine') { ctx.fillStyle = "white"; ctx.shadowBlur = 10; ctx.shadowColor = "white"; } else { ctx.fillStyle = "black"; }
    ctx.fillRect(x + 8, y + 8, 4, 4); ctx.fillRect(x + 18, y + 8, 4, 4);
    ctx.shadowBlur = 0;
}

function loop() {
    if(!gameActive) return;
    let d = Math.floor(player.x / 50);

    // CONTADOR DE METROS NA HUD
    let cdTarget = currentSkin === 'mrbeast' ? 200 : 150;
    let diff = d - lastPowerDist;
    let progress = Math.min(1, diff / cdTarget);
    let faltam = Math.max(0, cdTarget - diff);

    document.getElementById("abilityFill").style.width = (progress * 100) + "%";
    document.getElementById("abilityFill").style.background = progress >= 1 ? "#00ff00" : "#ffcc00";
    
    if (currentSkin === 'steve') {
        document.getElementById("abilityText").innerText = "SEM PODER";
    } else {
        document.getElementById("abilityText").innerText = progress >= 1 ? "PODER PRONTO!" : `FALTAM: ${faltam}m`;
    }

    if(keys.left) player.vx = -7.5; else if(keys.right) player.vx = 7.5; else player.vx *= 0.8;
    if(!godMode) player.vy += 0.85; else player.vy = 0;
    
    player.x += player.vx;
    player.y += player.vy;

    player.ground = false;
    for(let pos in world) {
        let [bx, by] = pos.split(",").map(Number);
        if(player.x + 25 > bx && player.x < bx + 45 && player.y + 60 >= by && player.y + 60 <= by + 20) {
            if(player.vy >= 0) { 
                player.y = by - 60; 
                player.vy = 0; 
                player.ground = true; 
                player.jumps = 0;

                if(d >= nextCP) {
                    checkpointPos = { x: player.x, y: player.y };
                    hasCP = true;
                    let r = Math.random() * 100;
                    if(r <= 5) coins += 8; else if(r <= 25) coins += 4; else if(r <= 80) coins += 1;
                    save();
                    nextCP += 100;
                }
            }
        }
    }

    if(player.x > lastX - 1200) {
        let bx = Math.floor((lastX + 250)/50)*50;
        let by = Math.floor((canvas.height * 0.7)/50)*50 + (Math.random()*120 - 60);
        world[`${bx},${by}`] = "grass"; 
        world[`${bx+50},${by}`] = "grass"; 
        lastX = bx + 100;
    }

    cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
    ctx.fillStyle = "#87ceeb"; ctx.fillRect(0,0,canvas.width, canvas.height);

    for(let pos in world) {
        let [bx, by] = pos.split(",").map(Number);
        ctx.fillStyle = world[pos] === "magic" ? "#fff" : "#43a047";
        ctx.fillRect(bx - cameraX, by, 50, 10);
        ctx.fillStyle = "#6d4c41"; ctx.fillRect(bx - cameraX, by+10, 50, 40);
    }

    drawSkin(player.x - cameraX, player.y);

    if(player.y > canvas.height + 150 && !godMode) { 
        gameActive = false; 
        document.getElementById("deathMenu").style.display = "flex";
        document.getElementById("respawnBtn").innerText = hasCP ? "VOLTAR CHECKPOINT" : "RECOME√áAR";
    }
    
    document.getElementById("dist").innerText = d;
    document.getElementById("coins").innerText = coins;
    requestAnimationFrame(loop);
}

document.getElementById("jump").ontouchstart = (e) => { e.preventDefault(); jumpAction(); };
document.getElementById("power").ontouchstart = (e) => { e.preventDefault(); usePowerW(); };
document.getElementById("left").ontouchstart = (e) => { e.preventDefault(); keys.left = true; };
document.getElementById("left").ontouchend = () => keys.left = false;
document.getElementById("right").ontouchstart = (e) => { e.preventDefault(); keys.right = true; };
document.getElementById("right").ontouchend = () => keys.right = false;

window.onkeydown = (e) => {
    if(e.key === " ") jumpAction();
    if(e.key === "ArrowLeft") keys.left = true;
    if(e.key === "ArrowRight") keys.right = true;
    if(e.key.toLowerCase() === "w") usePowerW();
};
window.onkeyup = (e) => { if(e.key === "ArrowLeft") keys.left = false; if(e.key === "ArrowRight") keys.right = false; };
</script>
</body>
</html>
