<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Steve Parkour Multiplataforma</title>
    <style>
        body { margin: 0; overflow: hidden; background: #9db9eb; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        
        /* Menu e UI */
        #ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); color: white; padding: 12px; border-radius: 8px; z-index: 100; pointer-events: none; display: none; }
        #menu { position: absolute; inset: 0; background: #9db9eb; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; }
        .btn-start { padding: 20px 50px; background: #4caf50; color: white; border: none; border-bottom: 5px solid #2e7d32; font-size: 26px; font-weight: bold; border-radius: 12px; cursor: pointer; }

        /* Controles Mobile (Escondidos no PC automaticamente via JS) */
        .controls { position: absolute; bottom: 30px; width: 100%; display: none; justify-content: space-between; padding: 0 30px; box-sizing: border-box; z-index: 150; }
        .ctrl-group { display: flex; gap: 20px; }
        .ctrl-btn { width: 80px; height: 80px; background: rgba(255,255,255,0.3); border: 3px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; color: #222; user-select: none; -webkit-user-select: none; }
        .jump-btn { width: 130px; border-radius: 40px; }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="color:white; text-shadow: 4px 4px #000; font-size: 40px;">STEVE PARKOUR</h1>
        <p style="color: white; margin-bottom: 20px;">PC: Setas e Espaço | Celular: Botões na tela</p>
        <button class="btn-start" onclick="initGame()">JOGAR</button>
    </div>

    <div id="ui">
        <b>METROS: <span id="dist">0</span>m</b><br>
        <small>Queda: Nível 8 | Pulo: Nível 7</small>
    </div>

    <div class="controls" id="mobileControls">
        <div class="ctrl-group">
            <div class="ctrl-btn" id="btnLeft">←</div>
            <div class="ctrl-btn" id="btnRight">→</div>
        </div>
        <div class="ctrl-btn jump-btn" id="btnJump">PULO</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameRunning = false;
let world = {};
let particles = [];
let cameraX = 0;

// Configurações de Gravidade e Física
const GRAV_SUBIDA = 0.7; 
const GRAV_QUEDA = 0.8;  
const JUMP_FORCE = -16;
const SPEED = 6;

const player = {
    x: 100, y: 200, w: 30, h: 55,
    vx: 0, vy: 0,
    onGround: false
};

const input = { left: false, right: false };

// --- AJUSTE DE TELA DINÂMICO ---
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function initGame() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("ui").style.display = "block";
    
    // Só mostra botões se for dispositivo touch
    if ('ontouchstart' in window) {
        document.getElementById("mobileControls").style.display = "flex";
    }
    
    // Gerar chão inicial sólido
    for(let i=0; i<12; i++) world[`${i*50},${Math.floor(canvas.height*0.75/50)*50}`] = "grass";
    
    gameRunning = true;
    requestAnimationFrame(loop);
}

// --- COMANDOS PC (TECLADO) ---
window.addEventListener("keydown", (e) => {
    if(e.code === "ArrowLeft") input.left = true;
    if(e.code === "ArrowRight") input.right = true;
    if(e.code === "Space" || e.code === "ArrowUp") {
        if(player.onGround) player.vy = JUMP_FORCE;
    }
});
window.addEventListener("keyup", (e) => {
    if(e.code === "ArrowLeft") input.left = false;
    if(e.code === "ArrowRight") input.right = false;
});

// --- COMANDOS CELULAR (TOUCH) ---
const setupTouch = (id, key) => {
    const el = document.getElementById(id);
    el.addEventListener("touchstart", (e) => { e.preventDefault(); if(key) input[key] = true; else if(player.onGround) player.vy = JUMP_FORCE; });
    el.addEventListener("touchend", (e) => { e.preventDefault(); if(key) input[key] = false; });
};
setupTouch("btnLeft", "left");
setupTouch("btnRight", "right");
setupTouch("btnJump", null);

function generateWorld(fromX) {
    let x = fromX;
    for(let i=0; i<10; i++) {
        x += 160 + Math.random() * 70;
        let y = (canvas.height * 0.4) + Math.random() * (canvas.height * 0.4);
        let pos = `${Math.floor(x/50)*50},${Math.floor(y/50)*50}`;
        world[pos] = "grass";
    }
}

function loop() {
    if(!gameRunning) return;

    // Movimentação
    if(input.left) player.vx = -SPEED;
    else if(input.right) player.vx = SPEED;
    else player.vx *= 0.8;

    // Gravidade 7 e 8
    player.vy += (player.vy < 0) ? GRAV_SUBIDA : GRAV_QUEDA;

    player.x += player.vx;
    player.y += player.vy;

    // Colisão
    player.onGround = false;
    for(let pos in world) {
        let [bx, by] = pos.split(",").map(Number);
        if(player.x + player.w > bx && player.x < bx + 50 &&
           player.y + player.h > by && player.y + player.h < by + 20) {
            player.y = by - player.h;
            player.vy = 0;
            player.onGround = true;
        }
    }

    // Morte
    if(player.y > canvas.height + 100) {
        gameRunning = false;
        setTimeout(() => location.reload(), 500);
    }

    // Câmera suave
    cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;

    // Desenho
    ctx.clearRect(0,0,canvas.width, canvas.height);
    
    // Blocos
    for(let pos in world) {
        let [bx, by] = pos.split(",").map(Number);
        if(bx > cameraX - 100 && bx < cameraX + canvas.width) {
            ctx.fillStyle = "#795548"; // Terra
            ctx.fillRect(bx - cameraX, by, 50, 50);
            ctx.fillStyle = "#4caf50"; // Grama
            ctx.fillRect(bx - cameraX, by, 50, 15);
        }
    }

    // Steve Herobrine (HD simplificado)
    let sx = player.x - cameraX;
    ctx.fillStyle = "#3c44aa"; ctx.fillRect(sx + 5, player.y + 35, 20, 20); // Calça
    ctx.fillStyle = "#3aa0a2"; ctx.fillRect(sx, player.y + 15, player.w, 25); // Camisa
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx + 2, player.y, player.w - 4, 20); // Cabeça
    ctx.fillStyle = "white"; // Olhos Herobrine
    ctx.fillRect(sx + 5, player.y + 7, 6, 4);
    ctx.fillRect(sx + 19, player.y + 7, 6, 4);

    // Geração Infinita
    if(player.x > Object.keys(world).length * 20) generateWorld(player.x + 500);

    document.getElementById("dist").innerText = Math.floor(player.x/50);
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
