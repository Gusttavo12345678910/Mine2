<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Steve Parkour HD Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: linear-gradient(#87CEEB, #E0F6FF); font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        #ui { position: absolute; top: 15px; left: 20px; color: #333; background: rgba(255,255,255,0.9); padding: 12px 24px; border-radius: 10px; border-bottom: 5px solid #bdc3c7; pointer-events: none; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #fs-btn { position: absolute; top: 15px; right: 20px; padding: 12px 20px; background: #34495e; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; z-index: 100; border-bottom: 4px solid #2c3e50; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 50px; box-sizing: border-box; z-index: 100; }
        .btn-circle { width: 75px; height: 75px; background: rgba(255,255,255,0.8); border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; font-size: 26px; color: #2c3e50; box-shadow: 0 5px 0 rgba(0,0,0,0.2); user-select: none; }
        .btn-circle:active { transform: translateY(3px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); background: #fff; }
        #jump-btn { width: 120px; border-radius: 40px; font-size: 18px; }
    </style>
</head>
<body>
    <div id="ui">
        <b>NÍVEL: <span id="lvlNum">1</span></b> | <b>MORTES: <span id="deathNum">0</span></b>
    </div>
    <button id="fs-btn">TELA CHEIA</button>
    <div class="controls">
        <div style="display: flex; gap: 20px;">
            <div class="btn-circle" id="btnLeft">←</div>
            <div class="btn-circle" id="btnRight">→</div>
        </div>
        <div class="btn-circle" id="jump-btn">PULO</div>
    </div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let currentLevel = 1, deaths = 0, world = {}, particles = [], cameraX = 0, isChangingLevel = false;
const gridSize = 50;

// Velocidade ajustada para 4.4
const player = { 
    x: 100, y: 300, w: 30, h: 54, 
    vx: 0, vy: 0, speed: 4.4, jump: -14, 
    onGround: false, animStep: 0
};

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.onresize = resize; resize();

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, type, dur) {
    if(audioCtx.state === 'suspended') return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + dur);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
}

function generateLevel(lvl) {
    world = {}; player.x = 80; player.y = 300; player.vx = 0; player.vy = 0;
    cameraX = 0; isChangingLevel = false;
    for(let i=0; i<6; i++) world[`${i*gridSize},${500}`] = "grass";
    let lastX = 300, lastY = 500;
    const steps = 8 + lvl;
    for(let i = 0; i < steps; i++) {
        lastX += 140 + Math.random() * 60;
        lastY += (Math.random() - 0.5) * 180;
        lastY = Math.max(250, Math.min(canvas.height - 150, lastY));
        world[`${Math.floor(lastX/gridSize)*gridSize},${Math.floor(lastY/gridSize)*gridSize}`] = (i === steps - 1) ? "gold" : "stone";
    }
}

const input = { left: false, right: false, jump: false };
const setup = (id, k) => {
    const el = document.getElementById(id);
    el.addEventListener('touchstart', (e) => { e.preventDefault(); input[k] = true; audioCtx.resume(); });
    el.addEventListener('touchend', () => input[k] = false);
};
setup("btnLeft", "left"); setup("btnRight", "right"); setup("jump-btn", "jump");

function drawBlock(sx, y, type) {
    ctx.save();
    if(type === "grass") {
        // Terra
        ctx.fillStyle = "#5d4037"; ctx.fillRect(sx, y, gridSize, gridSize);
        // Detalhes da terra
        ctx.fillStyle = "#4e342e"; ctx.fillRect(sx+10, y+20, 5, 5); ctx.fillRect(sx+30, y+35, 5, 5);
        // Grama
        ctx.fillStyle = "#4caf50"; ctx.fillRect(sx, y, gridSize, 15);
        ctx.fillStyle = "#388e3c"; ctx.fillRect(sx, y+10, gridSize, 5);
    } else if(type === "stone") {
        ctx.fillStyle = "#757575"; ctx.fillRect(sx, y, gridSize, gridSize);
        ctx.fillStyle = "#9e9e9e"; ctx.fillRect(sx+4, y+4, gridSize-8, gridSize-8);
        ctx.fillStyle = "#616161"; ctx.fillRect(sx+10, y+10, 10, 2); ctx.fillRect(sx+25, y+25, 10, 2);
    } else if(type === "gold") {
        ctx.fillStyle = "#fbc02d"; ctx.fillRect(sx, y, gridSize, gridSize);
        ctx.fillStyle = "#fff176"; ctx.fillRect(sx+5, y+5, gridSize-10, gridSize-10);
        ctx.fillStyle = "#f9a825"; ctx.fillRect(sx+10, y+10, gridSize-20, gridSize-20);
    }
    ctx.restore();
}

function drawSteve(x, y) {
    let sx = x - cameraX;
    let swing = Math.sin(player.animStep) * 12;
    if(!player.onGround) swing = 20;

    ctx.save();
    // Cabeça
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx+5, y-10, 20, 20);
    ctx.fillStyle = "#4e342e"; ctx.fillRect(sx+5, y-10, 20, 5); // Cabelo
    // Olhos
    ctx.fillStyle = "white"; ctx.fillRect(sx+8, y, 4, 3); ctx.fillRect(sx+18, y, 4, 3);
    ctx.fillStyle = "#3f51b5"; ctx.fillRect(sx+9, y, 2, 3); ctx.fillRect(sx+19, y, 2, 3);
    // Corpo
    ctx.fillStyle = "#00bcd4"; ctx.fillRect(sx+5, y+10, 20, 25);
    // Braços
    ctx.fillStyle = "#d3a395";
    ctx.fillRect(sx-2 - (swing/2), y+10, 7, 20); // Braço 1
    ctx.fillRect(sx+25 + (swing/2), y+10, 7, 20); // Braço 2
    // Pernas
    ctx.fillStyle = "#3f51b5";
    ctx.fillRect(sx+5, y+35 + (swing > 0 ? -3:0), 9, 18);
    ctx.fillRect(sx+16, y+35 + (swing > 0 ? 0:-3), 9, 18);
    ctx.restore();
}

function update() {
    if(isChangingLevel) { draw(); requestAnimationFrame(update); return; }

    if (input.left) { player.vx = -player.speed; player.animStep += 0.25; }
    else if (input.right) { player.vx = player.speed; player.animStep += 0.25; }
    else { player.vx *= 0.8; player.animStep = 0; }

    player.x += player.vx;
    if(check(player.x+4, player.y+5) || check(player.x+player.w-4, player.y+5)) player.x -= player.vx;

    player.vy += 0.7; player.y += player.vy;
    let feet = check(player.x+5, player.y+player.h) || check(player.x+player.w-5, player.y+player.h);
    
    if(feet) {
        if(feet === "gold") {
            isChangingLevel = true;
            playSound(500, 'sine', 0.2);
            currentLevel++; document.getElementById("lvlNum").innerText = currentLevel;
            setTimeout(() => generateLevel(currentLevel), 400);
            return;
        }
        player.y = Math.floor((player.y+player.h)/gridSize)*gridSize - player.h;
        player.vy = 0; player.onGround = true;
    } else player.onGround = false;

    if(input.jump && player.onGround) { player.vy = player.jump; player.onGround = false; playSound(150, 'square', 0.1); }
    if(player.y > canvas.height + 100) { deaths++; document.getElementById("deathNum").innerText = deaths; playSound(100, 'sawtooth', 0.2); generateLevel(currentLevel); }

    cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
    draw();
    requestAnimationFrame(update);
}

function check(px, py) { return world[`${Math.floor(px/gridSize)*gridSize},${Math.floor(py/gridSize)*gridSize}`]; }

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Nuvens
    ctx.fillStyle = "white";
    for(let i=0; i<6; i++) {
        let nx = (i*400 - cameraX*0.2) % (canvas.width+400) - 100;
        ctx.beginPath(); ctx.roundRect(nx, 100+(i%2)*50, 120, 40, 20); ctx.fill();
    }

    for (let pos in world) {
        const [x, y] = pos.split(",").map(Number);
        if(x > cameraX - gridSize && x < cameraX + canvas.width) drawBlock(x - cameraX, y, world[pos]);
    }
    drawSteve(player.x, player.y);
}

document.getElementById("fs-btn").onclick = () => document.documentElement.requestFullscreen();
generateLevel(1); update();
</script>
</body>
</html>
