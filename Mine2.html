<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Steve Parkour - Herobrine Ability</title>
    <style>
        body { margin: 0; overflow: hidden; background: #9db9eb; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        
        #menu, #deathMenu, #shopMenu { 
            position: absolute; inset: 0; background: #9db9eb; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 200; text-align: center;
        }
        #deathMenu, #shopMenu { background: rgba(0,0,0,0.95); color: white; display: none; z-index: 300; }

        .btn { width: 300px; padding: 18px; margin: 8px; font-size: 20px; font-weight: bold; color: white; border: none; border-radius: 12px; cursor: pointer; }
        .btn-start { background: #4caf50; border-bottom: 6px solid #2e7d32; }
        .btn-shop { background: #9c27b0; border-bottom: 6px solid #4a148c; }
        .btn-menu { background: #757575; border-bottom: 6px solid #424242; }

        /* HUD Habilidade */
        #abilityHUD {
            position: absolute; top: 20px; right: 20px; width: 100px; height: 100px;
            background: rgba(0,0,0,0.7); border: 3px solid #00e5ff; border-radius: 15px;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            color: white; font-weight: bold; z-index: 100; text-align: center;
        }
        #abilityFill { position: absolute; bottom: 0; width: 100%; background: rgba(0, 229, 255, 0.4); transition: height 0.1s; }
        #abilityKey { font-size: 28px; z-index: 2; }
        #abilityStatus { font-size: 11px; z-index: 2; padding: 5px; }

        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); color: white; padding: 12px; border-radius: 10px; z-index: 100; display: none; }
        .controls { position: absolute; bottom: 35px; width: 100%; display: none; justify-content: space-between; padding: 0 40px; box-sizing: border-box; z-index: 150; }
        .ctrl-btn { width: 85px; height: 85px; background: rgba(255,255,255,0.4); border: 3px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; font-weight: bold; user-select: none; }
        .power-btn { background: rgba(0, 229, 255, 0.5); border-color: #00e5ff; }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="color:white; text-shadow: 4px 4px #000; font-size: 45px;">STEVE PARKOUR</h1>
        <button class="btn btn-start" onclick="initGame()">JOGAR</button>
        <button class="btn btn-shop" onclick="openShop()">LOJA SKINS üõí</button>
    </div>

    <div id="shopMenu">
        <h1>LOJA</h1>
        <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; border: 3px solid #9c27b0;">
            <h2>HEROBRINE</h2>
            <p>Habilidade (W): Cria 7 blocos de Diamante<br>Recarga: Percorrer 150 metros</p>
            <button class="btn btn-shop" onclick="equipHerobrine()">ATIVAR GR√ÅTIS</button>
        </div>
        <button class="btn btn-menu" onclick="closeShop()">VOLTAR</button>
    </div>

    <div id="abilityHUD">
        <div id="abilityFill"></div>
        <div id="abilityKey">W</div>
        <div id="abilityStatus">PRONTO</div>
    </div>

    <div id="ui">
        üë§ <b><span id="skinName">Steve</span></b><br>
        üèÅ <b><span id="dist">0</span>m</b> | üíé <b><span id="coins">0</span></b>
    </div>

    <div id="deathMenu">
        <h1 style="color:#ff5252;">FIM DE JOGO</h1>
        <button class="btn btn-start" onclick="initGame()">RECOME√áAR</button>
        <button class="btn btn-menu" onclick="goToMainMenu()">MENU</button>
    </div>

    <div class="controls" id="mobileControls">
        <div style="display: flex; gap: 15px;"><div class="ctrl-btn" id="btnLeft">‚Üê</div><div class="ctrl-btn" id="btnRight">‚Üí</div></div>
        <div style="display: flex; gap: 15px;"><div class="ctrl-btn power-btn" id="btnPower">W</div><div class="ctrl-btn" id="btnJump">‚Üë</div></div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameRunning = false, physicsActive = false, world = {}, cameraX = 0, lastX = 0;
let coins = 0;
let currentSkin = "steve";

// L√≥gica de Habilidade Herobrine
let abilityReady = true;
let blocksLeftToPlace = 0;
let lastUsedDist = 0;
const RECHARGE_DIST = 150; 
const BLOCKS_PER_USE = 7;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playCoinSound() {
    const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
    osc.type = "triangle"; osc.frequency.setValueAtTime(1000, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
}

const GRAV_UP = 0.7, GRAV_DOWN = 0.82, JUMP_FORCE = -16.6, SPEED = 6.5;
const player = { x: 100, y: 0, w: 32, h: 60, vx: 0, vy: 0, onGround: false };
const input = { left: false, right: false };

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

function openShop() { document.getElementById("shopMenu").style.display = "flex"; }
function closeShop() { document.getElementById("shopMenu").style.display = "none"; }
function equipHerobrine() { currentSkin = "herobrine"; document.getElementById("skinName").innerText = "Herobrine"; closeShop(); }
function goToMainMenu() { gameRunning = false; document.getElementById("deathMenu").style.display = "none"; document.getElementById("ui").style.display = "none"; document.getElementById("menu").style.display = "flex"; document.getElementById("abilityHUD").style.display = "none"; }

function triggerAbility() {
    if (currentSkin === "herobrine" && abilityReady) {
        abilityReady = false;
        blocksLeftToPlace = BLOCKS_PER_USE;
        lastUsedDist = Math.floor(player.x / 50);
        updateAbilityHUD();
    }
}

function updateAbilityHUD() {
    const hud = document.getElementById("abilityHUD");
    const fill = document.getElementById("abilityFill");
    const status = document.getElementById("abilityStatus");
    
    if (currentSkin !== "herobrine") return;
    hud.style.display = "flex";

    let currentDist = Math.floor(player.x / 50);
    let traveled = currentDist - lastUsedDist;

    if (abilityReady) {
        fill.style.height = "100%";
        status.innerText = "PRONTO";
    } else {
        let needed = RECHARGE_DIST - traveled;
        if (needed <= 0) {
            abilityReady = true;
            updateAbilityHUD();
        } else {
            let percent = (traveled / RECHARGE_DIST) * 100;
            fill.style.height = Math.max(0, percent) + "%";
            status.innerText = `FALTAM ${needed}m`;
        }
    }
}

function generateBlocks(startX, count) {
    let x = startX;
    for(let i = 0; i < count; i++) {
        x += 180 + Math.random() * 125;
        let bx = Math.floor(x/50)*50, by = Math.floor(((canvas.height * 0.5))/50)*50;
        world[`${bx},${by}`] = "grass";
        lastX = x;
    }
}

function initGame() {
    if(audioCtx.state === 'suspended') audioCtx.resume();
    document.getElementById("menu").style.display = "none"; 
    document.getElementById("deathMenu").style.display = "none"; 
    document.getElementById("ui").style.display = "block";
    if ('ontouchstart' in window) document.getElementById("mobileControls").style.display = "flex";
    
    world = {}; cameraX = 0; player.x = 100; player.y = canvas.height/2; player.vy = 0;
    abilityReady = true; blocksLeftToPlace = 0; lastUsedDist = 0;
    updateAbilityHUD();

    for(let i=0; i<10; i++) world[`${i*50},${Math.floor(canvas.height*0.75/50)*50}`] = "grass";
    generateBlocks(600, 20);
    gameRunning = true; requestAnimationFrame(loop);
}

// Controles
window.addEventListener("keydown", (e) => {
    if(gameRunning && !physicsActive) physicsActive = true;
    if(e.code === "KeyA") input.left = true;
    if(e.code === "KeyD") input.right = true;
    if(e.code === "Space" && player.onGround) player.vy = JUMP_FORCE;
    if(e.code === "KeyW") triggerAbility();
});
window.addEventListener("keyup", (e) => {
    if(e.code === "KeyA") input.left = false;
    if(e.code === "KeyD") input.right = false;
});

// Mobile
const bind = (id, fn) => document.getElementById(id).addEventListener("touchstart", (e) => { e.preventDefault(); fn(); });
bind("btnLeft", () => { physicsActive = true; input.left = true; });
document.getElementById("btnLeft").addEventListener("touchend", () => input.left = false);
bind("btnRight", () => { physicsActive = true; input.right = true; });
document.getElementById("btnRight").addEventListener("touchend", () => input.right = false);
bind("btnJump", () => { physicsActive = true; if(player.onGround) player.vy = JUMP_FORCE; });
bind("btnPower", () => triggerAbility());

function loop() {
    if(!gameRunning) return;
    if(physicsActive) {
        if(input.left) player.vx = -SPEED; else if(input.right) player.vx = SPEED; else player.vx *= 0.8;
        player.vy += (player.vy < 0) ? GRAV_UP : GRAV_DOWN;
        player.x += player.vx; player.y += player.vy;
        player.onGround = false;

        // L√≥gica de colocar os 7 blocos
        if (blocksLeftToPlace > 0) {
            let bx = Math.floor((player.x + 40)/50)*50;
            let by = Math.floor((player.y + player.h)/50)*50;
            if (!world[`${bx},${by}`]) {
                world[`${bx},${by}`] = "diamond";
                blocksLeftToPlace--;
            }
        }

        // Verifica recarga por dist√¢ncia
        if (!abilityReady) updateAbilityHUD();

        for(let pos in world) {
            let [bx, by] = pos.split(",").map(Number);
            if(player.x + player.w > bx && player.x < bx + 50 && player.y + player.h > by && player.y + player.h < by + 20) {
                if(player.vy > 0) { player.y = by - player.h; player.vy = 0; player.onGround = true; }
            }
        }
        
        if(player.y > canvas.height + 150) {
            gameRunning = false; document.getElementById("deathMenu").style.display = "flex";
            return;
        }
        cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
        if(player.x > lastX - 1200) generateBlocks(lastX, 10);
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(let pos in world) {
        let [bx, by] = pos.split(",").map(Number);
        if(bx > cameraX - 100 && bx < cameraX + canvas.width) {
            ctx.fillStyle = world[pos] === "diamond" ? "#00e5ff" : "#795548";
            ctx.fillRect(bx - cameraX, by, 50, 50);
            if(world[pos] === "grass") { ctx.fillStyle = "#4caf50"; ctx.fillRect(bx - cameraX, by, 50, 15); }
            if(world[pos] === "diamond") { ctx.strokeStyle = "white"; ctx.strokeRect(bx-cameraX+2, by+2, 46, 46); }
        }
    }
    
    // Herobrine/Steve
    ctx.fillStyle = (currentSkin === "herobrine") ? "#333" : "#3aa0a2";
    ctx.fillRect(player.x - cameraX, player.y, player.w, player.h);
    if(currentSkin === "herobrine") {
        ctx.fillStyle = "white"; // Olhos brancos
        ctx.fillRect(player.x - cameraX + 6, player.y + 12, 6, 6);
        ctx.fillRect(player.x - cameraX + 20, player.y + 12, 6, 6);
    }

    document.getElementById("dist").innerText = Math.floor(player.x/50);
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
