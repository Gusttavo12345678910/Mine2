<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Beast Parkour Ultra - Final Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #4a90e2; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        canvas { display: block; image-rendering: pixelated; }
        
        .overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; color: white; text-align: center; backdrop-filter: blur(15px); background: rgba(30, 40, 60, 0.8); }
        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); color: #00ff00; padding: 12px; border-radius: 8px; z-index: 100; font-family: monospace; border: 1px solid #555; cursor: pointer; }
        
        #abilityHUD { position: absolute; top: 15px; right: 15px; width: 140px; height: 35px; background: rgba(0,0,0,0.8); border: 2px solid #fff; border-radius: 8px; z-index: 100; display: none; overflow: hidden; }
        #abilityFill { position: absolute; left: 0; height: 100%; width: 100%; background: #00e5ff; transition: width 0.1s; }
        #abilityText { position: relative; width: 100%; text-align: center; line-height: 35px; font-weight: bold; font-size: 13px; }

        .btn { width: 260px; padding: 15px; margin: 10px; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; color: white; text-transform: uppercase; transition: 0.2s; box-shadow: 0 4px #222; }
        .btn-start { background: #4caf50; }
        .btn-shop { background: #9c27b0; }
        .btn-admin { background: #f44336; border-bottom: 4px solid #800; }

        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 50px; box-sizing: border-box; z-index: 500; pointer-events: none; }
        .ctrl-group { display: flex; gap: 25px; pointer-events: auto; }
        .ctrl-btn { width: 85px; height: 85px; background: rgba(255,255,255,0.15); border: 3px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; color: white; user-select: none; backdrop-filter: blur(5px); }
    </style>
</head>
<body>

    <div id="ui">DIST√ÇNCIA: <span id="dist">0</span>m | üíé <span id="coins">0</span></div>
    
    <div id="abilityHUD">
        <div id="abilityFill"></div>
        <div id="abilityText">PODER (W)</div>
    </div>

    <div id="adminPanel" class="overlay" style="display:none; background: rgba(20,0,0,0.95);">
        <h1 style="color:#ff4444">ADMIN TERMINAL GU24</h1>
        <button class="btn btn-admin" onclick="addGems()">+1 MILH√ÉO DE GEMAS üíé</button>
        <button class="btn btn-admin" onclick="toggleGodMode()">MODO DEUS (VOAR): <span id="godStatus">OFF</span></button>
        <button class="btn" style="background:#555" onclick="document.getElementById('adminPanel').style.display='none'">FECHAR</button>
    </div>

    <div id="menu" class="overlay">
        <h1 style="font-size: 45px; text-shadow: 4px 4px #000;">BEAST PARKOUR HD</h1>
        <p>Checkpoint: 80m + a cada 100m</p>
        <button class="btn btn-start" onclick="startGame()">JOGAR</button>
        <button class="btn btn-shop" onclick="openShop()">LOJA DE SKINS</button>
    </div>

    <div id="shop" class="overlay" style="display:none">
        <h2>ESCOLHER PERSONAGEM</h2>
        <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin: 20px;">
            <button class="btn" style="background:#2c3e50" onclick="buyOrSelect('steve', 0)">STEVE (GR√ÅTIS)</button>
            <button class="btn" style="background:#e67e22" onclick="buyOrSelect('alex', 0)">ALEX (GR√ÅTIS)</button>
            <button class="btn" style="background:#00a8ff" onclick="buyOrSelect('mrbeast', 200)">MRBEAST (üíé200)</button>
            <button class="btn" style="background:#111" onclick="buyOrSelect('herobrine', 2500)">HEROBRINE (üíé2500)</button>
        </div>
        <button class="btn" style="background:#777" onclick="document.getElementById('shop').style.display='none'">VOLTAR</button>
    </div>

    <div class="controls" id="gameControls" style="display:none">
        <div class="ctrl-group">
            <div class="ctrl-btn" id="leftBtn">‚Üê</div>
            <div class="ctrl-btn" id="rightBtn">‚Üí</div>
        </div>
        <div class="ctrl-group">
            <div class="ctrl-btn" style="color:#00e5ff; border-color:#00e5ff" id="powerBtn">W</div>
            <div class="ctrl-btn" id="jumpBtn">‚Üë</div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameRunning = false, world = [], items = [], cameraX = 0;
let coins = parseInt(localStorage.getItem("coins")) || 0;
let currentSkin = localStorage.getItem("skin") || "steve";
let ownedSkins = JSON.parse(localStorage.getItem("ownedSkins")) || ["steve", "alex"];
let godMode = false, isAdminAuthenticated = false, lastCheckpointX = 110, lastCheckpointY = 100;
let lastCheckpointMeter = -20;

const player = { x: 100, y: 100, vx: 0, vy: 0, w: 30, h: 60, onGround: false, canDoubleJump: false, lastAbilityDist: -200 };
const keys = { left: false, right: false, up: false, down: false };

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.onresize = resize; resize();

// --- SISTEMA ADMIN ---
function tryAdmin() {
    if(isAdminAuthenticated) { document.getElementById("adminPanel").style.display = "flex"; return; }
    let email = prompt("E-mail Admin:");
    if(email === "gu24gamer@gmail.com") {
        let senha = prompt("Senha de Seguran√ßa:");
        if(senha === "gu_totoso_24/11/2015") {
            isAdminAuthenticated = true; document.getElementById("adminPanel").style.display = "flex";
        } else { alert("Senha Incorreta!"); }
    }
}
document.getElementById("ui").onclick = () => { tryAdmin(); };
function addGems() { coins += 1000000; save(); alert("Gemas Adicionadas!"); }
function toggleGodMode() { godMode = !godMode; document.getElementById("godStatus").innerText = godMode ? "ON" : "OFF"; }

// --- LOJA ---
function openShop() { document.getElementById("shop").style.display = "flex"; }
function buyOrSelect(skin, price) {
    if(ownedSkins.includes(skin)) { currentSkin = skin; save(); document.getElementById("shop").style.display = "none"; }
    else if(coins >= price) { 
        coins -= price; ownedSkins.push(skin); currentSkin = skin; save(); 
        alert("Desbloqueado!"); document.getElementById("shop").style.display = "none"; 
    } else { alert("üíé Insuficientes!"); }
}
function save() { 
    localStorage.setItem("coins", coins); 
    localStorage.setItem("skin", currentSkin);
    localStorage.setItem("ownedSkins", JSON.stringify(ownedSkins));
}

// --- GERADORES ---
function spawnEmerald(x, y) {
    let rand = Math.random() * 100;
    let type = null;
    if(rand <= 5) type = { color: "#ff4444", val: 8 }; // 5% Vermelha
    else if(rand <= 25) type = { color: "#44aaff", val: 4 }; // 20% Azul
    else if(rand <= 80) type = { color: "#44ff44", val: 1 }; // 55% Verde
    
    if(type) items.push({ x: x + 15, y: y - 40, w: 20, h: 20, type: "gem", color: type.color, value: type.val });
}

function startGame() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("gameControls").style.display = "flex";
    world = []; items = []; lastCheckpointMeter = -20;
    world.push({ x: 100, y: canvas.height - 150, w: 50, h: 600 });
    player.x = 110; player.y = canvas.height - 300; lastCheckpointX = 110; lastCheckpointY = player.y;
    gameRunning = true; loop();
}

function handlePower() {
    let d = Math.floor(player.x / 50);
    if(currentSkin === "herobrine" && (d - player.lastAbilityDist) >= 200 && !player.onGround) {
        player.x += 1000; player.lastAbilityDist = d; player.vy = -2;
    } else if(currentSkin === "mrbeast" && !player.onGround && player.canDoubleJump) {
        player.vy = -16; player.canDoubleJump = false;
    }
}

function drawPlayer(x, y) {
    let px = x - cameraX, py = y;
    let colors = {
        steve: { body: "#3a81a7", pants: "#4e3b2f", skin: "#ffdbac", hair: "#5d3c31" },
        alex: { body: "#4caf50", pants: "#6d4c41", skin: "#ffdbac", hair: "#e67e22" },
        mrbeast: { body: "#00a8ff", pants: "#222", skin: "#ffdbac", hair: "#111" },
        herobrine: { body: "#333", pants: "#111", skin: "#ffdbac", hair: "#5d3c31" }
    }[currentSkin];
    ctx.fillStyle = colors.pants; ctx.fillRect(px+5, py+40, 10, 20); ctx.fillRect(px+15, py+40, 10, 20);
    ctx.fillStyle = colors.body; ctx.fillRect(px+5, py+20, 20, 20); ctx.fillRect(px-2, py+20, 7, 18); ctx.fillRect(px+25, py+20, 7, 18);
    ctx.fillStyle = colors.skin; ctx.fillRect(px+5, py, 20, 20);
    ctx.fillStyle = colors.hair; ctx.fillRect(px+5, py, 20, 5);
    if(currentSkin === 'herobrine') { ctx.fillStyle = "white"; ctx.fillRect(px+8, py+8, 4, 4); ctx.fillRect(px+18, py+8, 4, 4); }
}

function loop() {
    if(!gameRunning) return;
    let distAtual = Math.floor(player.x / 50);

    const hud = document.getElementById("abilityHUD");
    if(currentSkin === "herobrine" || currentSkin === "mrbeast") {
        hud.style.display = "block";
        let p = Math.min(1, (distAtual - player.lastAbilityDist) / 200);
        document.getElementById("abilityFill").style.width = (p * 100) + "%";
    }

    if(keys.left) player.vx = -8; else if(keys.right) player.vx = 8; else player.vx *= 0.8;
    if(godMode) { if(keys.up) player.vy = -10; else if(keys.down) player.vy = 10; else player.vy = 0; } 
    else { player.vy += 0.85; }
    player.x += player.vx; player.y += player.vy;

    // Colis√£o Blocos (Refor√ßada)
    player.onGround = false;
    world.forEach(b => {
        if (player.x + player.w > b.x && player.x < b.x + b.w) {
            if (player.vy >= 0 && (player.y + player.h) >= b.y && (player.y + player.h) <= b.y + player.vy + 10) {
                if (!godMode) { player.y = b.y - player.h; player.vy = 0; player.onGround = true; player.canDoubleJump = true; }
            }
        }
    });

    // Colis√£o Itens
    items.forEach((it, i) => {
        if(player.x < it.x + it.w && player.x + player.w > it.x && player.y < it.y + it.h && player.y + player.h > it.y) {
            if(it.type === "gem") { coins += it.value; items.splice(i, 1); }
            if(it.type === "checkpoint" && !it.collected) {
                coins += 10; it.collected = true; it.color = "#ffff00";
                lastCheckpointX = it.x; lastCheckpointY = it.y - 100;
            }
        }
    });

    // Gerador de N√≠vel
    if(world[world.length-1].x < player.x + canvas.width) {
        let last = world[world.length-1];
        let gap = 220 + Math.random() * 150;
        let newX = last.x + gap;
        let newY = Math.max(200, Math.min(canvas.height - 150, last.y + (Math.random()*180-90)));
        world.push({ x: newX, y: newY, w: 50, h: 600 });
        
        let meter = Math.floor(newX / 50);
        let target = (lastCheckpointMeter === -20) ? 80 : lastCheckpointMeter + 100;
        
        if(meter >= target) {
            items.push({ x: newX + 10, y: newY - 60, w: 30, h: 60, type: "checkpoint", color: "#ff00ff", collected: false });
            lastCheckpointMeter = target;
        } else {
            spawnEmerald(newX, newY);
        }
    }

    cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
    ctx.fillStyle = "#87ceeb"; ctx.fillRect(0,0,canvas.width, canvas.height);
    
    world.forEach(b => {
        ctx.fillStyle = "#5d3c31"; ctx.fillRect(b.x - cameraX, b.y + 10, b.w, b.h);
        ctx.fillStyle = "#4caf50"; ctx.fillRect(b.x - cameraX, b.y, b.w, 12);
    });

    items.forEach(it => {
        ctx.fillStyle = it.color;
        if(it.type === "gem") {
            ctx.beginPath(); ctx.moveTo(it.x - cameraX + 10, it.y); ctx.lineTo(it.x - cameraX + 20, it.y + 10);
            ctx.lineTo(it.x - cameraX + 10, it.y + 20); ctx.lineTo(it.x - cameraX, it.y + 10); ctx.fill();
        } else {
            ctx.fillRect(it.x - cameraX, it.y, 5, it.h); ctx.fillRect(it.x - cameraX, it.y, 25, 15);
        }
    });

    drawPlayer(player.x, player.y);

    if(player.y > canvas.height + 200) {
        player.x = lastCheckpointX; player.y = lastCheckpointY; player.vy = 0; player.vx = 0;
    }
    
    document.getElementById("dist").innerText = distAtual;
    document.getElementById("coins").innerText = coins;
    requestAnimationFrame(loop);
}

const bind = (id, start, end) => {
    let el = document.getElementById(id);
    el.addEventListener("touchstart", (e) => { e.preventDefault(); start(); });
    el.addEventListener("touchend", (e) => { e.preventDefault(); end(); });
};
bind("leftBtn", () => keys.left = true, () => keys.left = false);
bind("rightBtn", () => keys.right = true, () => keys.right = false);
bind("jumpBtn", () => keys.up = true, () => keys.up = false);
document.getElementById("powerBtn").ontouchstart = (e) => { e.preventDefault(); handlePower(); };

window.onkeydown = (e) => {
    if(e.key.toLowerCase() === "p") tryAdmin();
    if(e.key === "ArrowLeft") keys.left = true;
    if(e.key === "ArrowRight") keys.right = true;
    if(e.key === " " || e.key === "ArrowUp") keys.up = true;
    if(e.key.toLowerCase() === "s" || e.key === "ArrowDown") keys.down = true;
    if(e.key.toLowerCase() === "w") handlePower();
};
window.onkeyup = (e) => {
    if(e.key === "ArrowLeft") keys.left = false;
    if(e.key === "ArrowRight") keys.right = false;
    if(e.key === " " || e.key === "ArrowUp") keys.up = false;
    if(e.key.toLowerCase() === "s" || e.key === "ArrowDown") keys.down = false;
};
</script>
</body>
</html>
