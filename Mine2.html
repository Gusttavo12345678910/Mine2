<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Steve Parkour Endless - Menu Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #9db9eb; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        
        /* Estilo do Menu */
        #menu {
            position: absolute; width: 100%; height: 100%;
            background: rgba(157, 185, 235, 0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 200; gap: 20px;
        }
        .menu-btn {
            width: 250px; padding: 15px;
            background: #fff; border: 3px solid #333; border-radius: 10px;
            font-size: 20px; font-weight: bold; color: #333;
            cursor: pointer; text-align: center; box-shadow: 0 5px 0 #888;
        }
        .menu-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #888; }
        h1 { color: #fff; text-shadow: 3px 3px 0 #333; font-size: 40px; margin-bottom: 20px; }

        #ui { position: absolute; top: 10px; left: 10px; background: rgba(238,245,255,0.9); padding: 15px; border-radius: 5px; border: 1px solid #ccc; z-index: 10; min-width: 150px; display: none; }
        .controls { position: absolute; bottom: 20px; width: 100%; display: none; justify-content: center; gap: 30px; z-index: 10; }
        .btn { width: 75px; height: 75px; background: rgba(255,255,255,0.8); border: 2px solid #aaa; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #555; font-weight: bold; user-select: none; }
    </style>
</head>
<body>

    <div id="menu">
        <h1>STEVE PARKOUR</h1>
        <div class="menu-btn" onclick="startGame()">COMEÇAR JOGO</div>
        <div class="menu-btn" onclick="showRecord()">VER RECORDE</div>
    </div>

    <div id="ui">
        <b>Metros: <span id="dist">0</span>m</b><br>
        <small>Passe pelos Checkpoints!</small>
    </div>

    <div class="controls" id="gameControls">
        <div class="btn" id="left">←</div>
        <div class="btn" id="right">→</div>
        <div class="btn" id="jump" style="width:100px; border-radius:50px;">PULO</div>
    </div>

    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let cameraX = 0, world = {}, lastGeneratedX = 0;
let checkpointX = 80, checkpointY = 350;
let gameActive = false;

const player = { 
    x: 80, y: 350, w: 32, h: 56, 
    vx: 0, vy: 0, speed: 4.4, jump: -14, 
    onGround: false, animStep: 0 
};

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.onresize = resize;
resize();

// Funções do Menu
function startGame() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("ui").style.display = "block";
    document.getElementById("gameControls").style.display = "flex";
    gameActive = true;
    update(); // Inicia o loop
}

function showRecord() {
    let record = localStorage.getItem("highScore") || 0;
    alert("O teu recorde atual é: " + record + " metros!");
}

function saveRecord(dist) {
    let currentRecord = localStorage.getItem("highScore") || 0;
    if (dist > currentRecord) {
        localStorage.setItem("highScore", dist);
    }
}

// Gerador de Parkour Infinito
function expandWorld(startX) {
    let x = startX;
    let y = 450;
    for(let i = 0; i < 10; i++) {
        x += 135 + Math.random() * 55;
        y += (Math.random() - 0.5) * 160;
        y = Math.max(200, Math.min(canvas.height - 150, y));
        let gx = Math.floor(x/50)*50;
        let gy = Math.floor(y/50)*50;
        if (i === 9) world[`${gx},${gy}`] = "gold";
        else {
            let types = ["stone", "brick", "dirt"];
            world[`${gx},${gy}`] = types[Math.floor(Math.random()*types.length)];
        }
    }
    lastGeneratedX = x;
}

// Inicialização
for(let i=0; i<5; i++) world[`${i*50},450`] = "grass";
expandWorld(250);

const input = { left: false, right: false, jump: false };
const bind = (id, k) => {
    const el = document.getElementById(id);
    el.addEventListener('touchstart', (e) => { e.preventDefault(); input[k] = true; });
    el.addEventListener('touchend', () => input[k] = false);
};
bind("left", "left"); bind("right", "right"); bind("jump", "jump");

function drawSteve(x, y) {
    let sx = x - cameraX;
    let swing = Math.sin(player.animStep) * 15;
    if(!player.onGround) swing = 15;
    if(Math.abs(player.vx) < 0.1 && player.onGround) swing = 0;

    ctx.save();
    ctx.lineWidth = 2; ctx.strokeStyle = "black";
    // Braço Longe
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx + 10 - swing/2, y + 15, 8, 20); ctx.strokeRect(sx + 10 - swing/2, y + 15, 8, 20);
    // Pernas
    ctx.fillStyle = "#3c44aa";
    ctx.fillRect(sx + 4, y + 34 + (swing > 0 ? -2 : 0), 12, 20); ctx.strokeRect(sx + 4, y + 34 + (swing > 0 ? -2 : 0), 12, 20);
    ctx.fillRect(sx + 16, y + 34 + (swing > 0 ? 0 : -2), 12, 20); ctx.strokeRect(sx + 16, y + 34 + (swing > 0 ? 0 : -2), 12, 20);
    // Tronco
    ctx.fillStyle = "#3aa0a2"; ctx.fillRect(sx+4, y+10, 24, 24); ctx.strokeRect(sx+4, y+10, 24, 24);
    // Cabeça
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx+4, y-14, 24, 24); ctx.strokeRect(sx+4, y-14, 24, 24);
    ctx.fillStyle = "#5d3a1a"; ctx.fillRect(sx+4, y-14, 24, 6);
    ctx.fillStyle = "#5d3a1a"; ctx.fillRect(sx+10, y+4, 12, 3);
    ctx.fillStyle = "white"; ctx.fillRect(sx+6, y-2, 6, 4); ctx.fillRect(sx+20, y-2, 6, 4);
    // Braço Perto
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx + 10 + swing/2, y + 15, 8, 20); ctx.strokeRect(sx + 10 + swing/2, y + 15, 8, 20);
    ctx.restore();
}

function drawBlock(x, y, type) {
    let sx = x - cameraX;
    ctx.save();
    if(type === "grass") {
        ctx.fillStyle = "#795548"; ctx.fillRect(sx, y, 50, 50);
        ctx.fillStyle = "#2ecc71"; ctx.fillRect(sx, y, 50, 15);
    } else if(type === "stone") {
        ctx.fillStyle = "#95a5a6"; ctx.fillRect(sx, y, 50, 50);
        ctx.fillStyle = "rgba(0,0,0,0.1)"; ctx.fillText("S", sx+20, y+30);
    } else if(type === "brick") {
        ctx.fillStyle = "#a54331"; ctx.fillRect(sx, y, 50, 50);
    } else if(type === "dirt") {
        ctx.fillStyle = "#795548"; ctx.fillRect(sx, y, 50, 50);
        ctx.fillStyle = "rgba(0,0,0,0.1)"; ctx.fillText("D", sx+20, y+30);
    } else if(type === "gold") {
        ctx.fillStyle = "#f1c40f"; ctx.fillRect(sx, y, 50, 50);
        ctx.fillStyle = "#000"; ctx.font = "bold 12px Arial"; ctx.fillText("SAVE", sx+8, y+30);
    }
    ctx.restore();
}

function update() {
    if (!gameActive) return;

    if (input.left) { player.vx = -player.speed; player.animStep += 0.2; }
    else if (input.right) { player.vx = player.speed; player.animStep += 0.2; }
    else { player.vx *= 0.8; player.animStep = 0; }

    player.x += player.vx;
    if(check(player.x+5, player.y+5) || check(player.x+player.w-5, player.y+5)) player.x -= player.vx;

    player.vy += 0.7; player.y += player.vy;
    let ground = check(player.x+5, player.y+player.h) || check(player.x+player.w-5, player.y+player.h);
    
    if(ground) {
        if(ground === "gold") { checkpointX = player.x; checkpointY = Math.floor((player.y+player.h)/50)*50 - player.h; }
        player.y = Math.floor((player.y+player.h)/50)*50 - player.h;
        player.vy = 0; player.onGround = true;
    } else player.onGround = false;

    if(input.jump && player.onGround) { player.vy = player.jump; player.onGround = false; }
    
    if(player.y > canvas.height + 100) {
        player.x = checkpointX; player.y = checkpointY;
        player.vx = 0; player.vy = 0;
    }

    if (player.x + 1000 > lastGeneratedX) expandWorld(lastGeneratedX);

    cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
    let distAtual = Math.floor(player.x / 50);
    document.getElementById("dist").innerText = distAtual;
    saveRecord(distAtual);

    draw();
    requestAnimationFrame(update);
}

function check(px, py) { return world[`${Math.floor(px/50)*50},${Math.floor(py/50)*50}`]; }

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let pos in world) {
        let [x, y] = pos.split(",").map(Number);
        if (x > cameraX - 100 && x < cameraX + canvas.width + 100) drawBlock(x, y, world[pos]);
    }
    drawSteve(player.x, player.y);
}

// Desenho inicial estático (apenas para o fundo do menu)
function drawInitial() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let pos in world) {
        let [x, y] = pos.split(",").map(Number);
        if (x < canvas.width) drawBlock(x, y, world[pos]);
    }
    drawSteve(player.x, player.y);
}
drawInitial();
</script>
</body>
</html>
