<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Parkour das Esmeraldas</title>
    <style>
        body { margin: 0; overflow: hidden; background: #14141e; font-family: 'Segoe UI', Arial, sans-serif; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

<script>
/**
 * PROGRAMAÇÃO EM HTML5 / JAVASCRIPT
 * TIPO DE ARQUIVO: .html
 */

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- VARIÁVEIS DO JOGO ---
const BLOCK_SIZE = 50;
const PLAYER_SIZE = 40;
const GRAVITY = 0.8;

let state = 'MENU'; // Começa direto no MENU
let high_score = 0;

let player = {
    x: 50, y: 300,
    w: PLAYER_SIZE, h: PLAYER_SIZE,
    velX: 0, velY: 0,
    onGround: false,
    checkpointX: 50, checkpointY: 300,
    hasFirstCP: false,
    nextCP: 80,
    emeralds: 0,
    distance: 0
};

let platforms = [];
for (let i = 0; i < 500; i++) {
    platforms.push({
        x: i * 140,
        y: canvas.height - 150 - (i % 3 * 60),
        w: BLOCK_SIZE, h: BLOCK_SIZE
    });
}

const keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

function sortearEsmeralda() {
    let chance = Math.random() * 100;
    if (chance <= 5) player.emeralds += 8;      // Vermelha (5%)
    else if (chance <= 25) player.emeralds += 4; // Azul (20%)
    else if (chance <= 80) player.emeralds += 1; // Verde (55%)
}

function resetGame(total) {
    if (total) {
        player.x = 50; player.y = 300;
        player.emeralds = 0; player.distance = 0;
        player.hasFirstCP = false; player.nextCP = 80;
        player.checkpointX = 50; player.checkpointY = 300;
    } else {
        player.x = player.checkpointX;
        player.y = player.checkpointY;
    }
    player.velX = 0; player.velY = 0;
    state = 'JOGANDO';
}

function update() {
    if (state === 'MENU') {
        if (keys['Space']) resetGame(true);
        return;
    }
    if (state === 'MORTE') {
        if (keys['KeyC'] && player.hasFirstCP) resetGame(false);
        if (keys['KeyM']) state = 'MENU';
        return;
    }

    // Movimento
    player.velX = 0;
    if (keys['ArrowLeft'] || keys['KeyA']) player.velX = -6;
    if (keys['ArrowRight'] || keys['KeyD']) player.velX = 6;
    if ((keys['Space'] || keys['KeyW']) && player.onGround) {
        player.velY = -16;
        player.onGround = false;
    }

    player.velY += GRAVITY;
    player.x += player.velX;
    player.y += player.velY;
    player.distance = Math.floor(player.x / 10);
    if (player.distance > high_score) high_score = player.distance;

    // Colisão
    player.onGround = false;
    platforms.forEach(p => {
        if (player.x < p.x + p.w && player.x + player.w > p.x &&
            player.y < p.y + p.h && player.y + player.h > p.y) {
            if (player.velY > 0) {
                player.y = p.y - player.h;
                player.velY = 0;
                player.onGround = true;

                if (player.distance >= player.nextCP) {
                    player.checkpointX = player.x;
                    player.checkpointY = player.y;
                    player.hasFirstCP = true;
                    sortearEsmeralda();
                    player.nextCP += 100;
                }
            }
        }
    });

    if (player.y > canvas.height) state = 'MORTE';
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let camX = player.x - canvas.width / 2;

    if (state === 'MENU') {
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "bold 40px Arial";
        ctx.fillText("PARKOUR DAS ESMERALDAS", canvas.width/2, 200);
        ctx.font = "24px Arial";
        ctx.fillText(`RECORDE: ${high_score}m`, canvas.width/2, 260);
        ctx.fillStyle = "#00c8ff";
        ctx.fillText("Pressione ESPAÇO para Começar", canvas.width/2, 400);
    } 
    else {
        // Desenhar Blocos
        ctx.fillStyle = "#969696";
        platforms.forEach(p => {
            if (p.x - camX > -BLOCK_SIZE && p.x - camX < canvas.width) {
                ctx.fillRect(p.x - camX, p.y, p.w, p.h);
                ctx.strokeStyle = "white";
                ctx.strokeRect(p.x - camX, p.y, p.w, p.h);
            }
        });

        // Desenhar Player
        ctx.fillStyle = "#00c8ff";
        ctx.beginPath();
        ctx.roundRect(canvas.width/2 - player.w/2, player.y, player.w, player.h, 5);
        ctx.fill();

        // HUD
        ctx.textAlign = "left";
        ctx.fillStyle = "white";
        ctx.font = "bold 20px Arial";
        ctx.fillText(`Distância: ${player.distance}m`, 20, 40);
        ctx.fillStyle = "#50ff50";
        ctx.fillText(`Esmeraldas: ${player.emeralds}`, 20, 70);

        if (state === 'MORTE') {
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "red";
            ctx.textAlign = "center";
            ctx.font = "bold 40px Arial";
            ctx.fillText("VOCÊ CAIU!", canvas.width/2, canvas.height/2 - 50);
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            let msg = player.hasFirstCP ? `Aperte [C] para Checkpoint (${Math.floor(player.checkpointX/10)}m)` : "Sem Checkpoint (Pise aos 80m)";
            ctx.fillText(msg, canvas.width/2, canvas.height/2 + 20);
            ctx.fillText("Aperte [M] para Menu Principal", canvas.width/2, canvas.height/2 + 60);
        }
    }

    update();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
