<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Steve Parkour - Final Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #9db9eb; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        
        /* Telas e Menus */
        #menu, #scoreModal, #deathMenu { 
            position: absolute; inset: 0; background: #9db9eb; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 200; text-align: center;
        }

        #scoreModal, #deathMenu { background: rgba(0,0,0,0.9); color: white; display: none; z-index: 300; }

        /* Estilo dos Bot√µes */
        .btn { 
            width: 300px; padding: 18px; margin: 10px; font-size: 20px; font-weight: bold; 
            color: white; border: none; border-radius: 12px; cursor: pointer; transition: 0.2s;
            text-shadow: 2px 2px rgba(0,0,0,0.3);
        }
        .btn-start { background: #4caf50; border-bottom: 6px solid #2e7d32; }
        .btn-checkpoint { background: #2196f3; border-bottom: 6px solid #0d47a1; }
        .btn-restart { background: #f44336; border-bottom: 6px solid #b71c1c; }
        .btn-score { background: #ff9800; border-bottom: 6px solid #e68a00; }
        .btn:active { transform: translateY(4px); border-bottom-width: 2px; }
        .btn:disabled { background: #555; border-bottom: 3px solid #333; cursor: not-allowed; opacity: 0.5; }

        #nameInput { padding: 15px; font-size: 18px; border-radius: 8px; border: 3px solid #333; width: 240px; text-align: center; margin-bottom: 15px; }

        /* Interface em jogo */
        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); color: white; padding: 15px; border-radius: 10px; z-index: 100; display: none; border: 2px solid #fff; }
        
        #hint { 
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); 
            color: white; font-weight: bold; text-shadow: 2px 2px #000; font-size: 22px; 
            z-index: 50; display: none; background: rgba(0,0,0,0.5); padding: 15px 30px; 
            border-radius: 50px; border: 2px solid #fff; pointer-events: none;
        }

        /* Controles Celular */
        .controls { position: absolute; bottom: 35px; width: 100%; display: none; justify-content: space-between; padding: 0 40px; box-sizing: border-box; z-index: 150; }
        .ctrl-btn { width: 85px; height: 85px; background: rgba(255,255,255,0.4); border: 3px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; font-weight: bold; user-select: none; }
        .jump-btn { width: 140px; border-radius: 45px; background: rgba(255,255,255,0.6); }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="color:white; text-shadow: 4px 4px #000; font-size: 45px; margin-bottom: 5px;">STEVE PARKOUR</h1>
        <p style="color:white; font-weight:bold; margin-bottom: 20px;">CHECKPOINT A CADA 50m (BLOCO DE OURO)</p>
        <input type="text" id="nameInput" placeholder="Teu nome..." maxlength="12">
        <button class="btn btn-start" onclick="initGame(false)">NOVO JOGO</button>
        <button class="btn btn-score" onclick="showRecord()">VER RECORDE</button>
    </div>

    <div id="deathMenu">
        <h1 style="color:#ff5252; font-size: 45px; margin-bottom: 10px;">STEVE CAIU!</h1>
        <p id="deathInfo" style="font-size: 22px; margin-bottom: 25px;">Dist√¢ncia: 0m</p>
        <button id="resumeBtn" class="btn btn-checkpoint" onclick="initGame(true)">VOLTAR AO CHECKPOINT</button>
        <button class="btn btn-restart" onclick="initGame(false)">RECOME√áAR DO IN√çCIO</button>
    </div>

    <div id="scoreModal">
        <h2 style="font-size: 35px; color: #ff9800;">MELHOR MARCA</h2>
        <div style="font-size: 60px; margin: 20px 0;"><span id="bestScoreText">0</span>m</div>
        <p style="font-size: 20px;">Jogador: <span id="bestNameText">---</span></p>
        <button class="btn btn-restart" onclick="closeRecord()">VOLTAR</button>
    </div>

    <div id="hint">MOVE O STEVE PARA COME√áAR!</div>

    <div id="ui">
        üë§ <b><span id="displayName">Steve</span></b><br>
        üèÅ <b>DIST√ÇNCIA: <span id="dist">0</span>m</b>
    </div>

    <div class="controls" id="mobileControls">
        <div style="display: flex; gap: 20px;">
            <div class="ctrl-btn" id="btnLeft">‚Üê</div>
            <div class="ctrl-btn" id="btnRight">‚Üí</div>
        </div>
        <div class="ctrl-btn jump-btn" id="btnJump">PULO</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let gameRunning = false;
let physicsActive = false;
let world = {};
let cameraX = 0;
let lastX = 0;
let walkCycle = 0;

// Configura√ß√µes de Checkpoint
let lastCheckpoint = { x: 100, y: 0, active: false };
const CHECKPOINT_INTERVAL = 2500; // 50m (50px * 50)

// F√≠sica do Jogo (Gravidade 7 e 8)
const GRAV_UP = 0.7; 
const GRAV_DOWN = 0.8;
const JUMP_FORCE = -16.5; 
const SPEED = 6.5;

const player = { x: 100, y: 0, w: 32, h: 60, vx: 0, vy: 0, onGround: false };
const input = { left: false, right: false };

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// Recordes
function showRecord() {
    const best = localStorage.getItem("steve_record") || 0;
    const name = localStorage.getItem("steve_name") || "Ningu√©m";
    document.getElementById("bestScoreText").innerText = best;
    document.getElementById("bestNameText").innerText = name;
    document.getElementById("scoreModal").style.display = "flex";
}
function closeRecord() { document.getElementById("scoreModal").style.display = "none"; }
function updateRecord(score) {
    const currentBest = parseInt(localStorage.getItem("steve_record") || 0);
    if (score > currentBest) {
        localStorage.setItem("steve_record", score);
        localStorage.setItem("steve_name", document.getElementById("displayName").innerText);
    }
}

// Gerador de Mapa
function generateBlocks(startX, count) {
    let x = startX;
    for(let i = 0; i < count; i++) {
        x += 180 + Math.random() * 100;
        let blockX = Math.floor(x/50)*50;
        let y = (canvas.height * 0.4) + Math.random() * (canvas.height * 0.35);
        let blockY = Math.floor(y/50)*50;
        
        // Coloca ouro a cada 50 metros
        if (blockX > 0 && blockX % CHECKPOINT_INTERVAL < 250) {
             world[`${blockX},${blockY}`] = "gold";
        } else {
             world[`${blockX},${blockY}`] = "grass";
        }
        lastX = x;
    }
}

// Iniciar Jogo
function initGame(useCheckpoint) {
    const name = document.getElementById("nameInput").value.trim() || "Steve";
    document.getElementById("displayName").innerText = name;
    
    document.getElementById("menu").style.display = "none";
    document.getElementById("deathMenu").style.display = "none";
    document.getElementById("ui").style.display = "block";
    document.getElementById("hint").style.display = "block";
    
    if ('ontouchstart' in window) document.getElementById("mobileControls").style.display = "flex";

    if (!useCheckpoint) {
        // Zera tudo para novo jogo
        world = {}; cameraX = 0; player.x = 100; player.y = canvas.height/2; player.vy = 0;
        lastCheckpoint = { x: 100, y: player.y, active: false };
        for(let i=0; i<12; i++) world[`${i*50},${Math.floor(canvas.height*0.75/50)*50}`] = "grass";
        generateBlocks(600, 20);
    } else {
        // Renasce no Checkpoint
        player.x = lastCheckpoint.x;
        player.y = lastCheckpoint.y;
        player.vx = 0; player.vy = 0;
        cameraX = player.x - canvas.width/3;
    }
    
    physicsActive = false;
    gameRunning = true;
    requestAnimationFrame(loop);
}

function startAction() {
    if(!physicsActive && gameRunning) {
        physicsActive = true;
        document.getElementById("hint").style.display = "none";
    }
}

// Controles PC
window.addEventListener("keydown", (e) => {
    startAction();
    if(e.code === "ArrowLeft" || e.code === "KeyA") input.left = true;
    if(e.code === "ArrowRight" || e.code === "KeyD") input.right = true;
    if((e.code === "Space" || e.code === "ArrowUp" || e.code === "KeyW") && player.onGround) player.vy = JUMP_FORCE;
});
window.addEventListener("keyup", (e) => {
    if(e.code === "ArrowLeft" || e.code === "KeyA") input.left = false;
    if(e.code === "ArrowRight" || e.code === "KeyD") input.right = false;
});

// Controles Mobile
const bindTouch = (id, key) => {
    const el = document.getElementById(id);
    el.addEventListener("touchstart", (e) => { 
        e.preventDefault(); startAction();
        if(key) input[key] = true; else if(player.onGround) player.vy = JUMP_FORCE; 
    });
    el.addEventListener("touchend", () => { if(key) input[key] = false; });
};
bindTouch("btnLeft", "left"); bindTouch("btnRight", "right"); bindTouch("btnJump", null);

// Desenho do Steve Animado
function drawSteve(x, y) {
    let sx = x - cameraX;
    let sy = y;
    let swing = physicsActive ? Math.sin(walkCycle) * 12 : 0;
    ctx.fillStyle = "#303a9e"; ctx.fillRect(sx + 16, sy + 40 + (swing/2), 12, 20); // Perna 2
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx + 22, sy + 18 - (swing/2), 10, 22); // Bra√ßo 2
    ctx.fillStyle = "#3aa0a2"; ctx.fillRect(sx + 4, sy + 18, 24, 22); // Tronco
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx + 4, sy, 24, 20); // Pele
    ctx.fillStyle = "#4e342e"; ctx.fillRect(sx + 4, sy, 24, 6); ctx.fillRect(sx + 22, sy + 6, 6, 8); // Cabelo
    ctx.fillStyle = "white"; ctx.fillRect(sx + 8, sy + 8, 6, 4); ctx.fillRect(sx + 19, sy + 8, 6, 4); // Olhos
    ctx.fillStyle = "#3c44aa"; ctx.fillRect(sx + 4, sy + 40 - (swing/2), 12, 20); // Perna 1
    ctx.fillStyle = "#d3a395"; ctx.fillRect(sx - 2, sy + 18 + (swing/2), 10, 22); // Bra√ßo 1
}

function loop() {
    if(!gameRunning) return;

    if(physicsActive) {
        if(input.left) { player.vx = -SPEED; walkCycle += 0.2; }
        else if(input.right) { player.vx = SPEED; walkCycle += 0.2; }
        else { player.vx *= 0.8; walkCycle = 0; }

        player.vy += (player.vy < 0) ? GRAV_UP : GRAV_DOWN;
        player.x += player.vx;
        player.y += player.vy;

        player.onGround = false;
        for(let pos in world) {
            let [bx, by] = pos.split(",").map(Number);
            if(player.x + player.w > bx && player.x < bx + 50 && player.y + player.h > by && player.y + player.h < by + 20) {
                if(player.vy > 0) { 
                    player.y = by - player.h; player.vy = 0; player.onGround = true; 
                    if(world[pos] === "gold") lastCheckpoint = { x: bx, y: by - player.h, active: true };
                }
            }
        }

        if(player.y > canvas.height + 150) {
            gameRunning = false;
            const score = Math.floor(player.x/50);
            updateRecord(score);
            document.getElementById("deathInfo").innerText = "Fizeste " + score + " metros!";
            document.getElementById("deathMenu").style.display = "flex";
            document.getElementById("resumeBtn").disabled = !lastCheckpoint.active;
            return;
        }

        cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
        if(player.x > lastX - 1200) generateBlocks(lastX, 10);
    }

    // Desenhar Mundo
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(let pos in world) {
        let [bx, by] = pos.split(",").map(Number);
        if(bx > cameraX - 100 && bx < cameraX + canvas.width) {
            if(world[pos] === "gold") {
                ctx.fillStyle = "#FFD700"; ctx.fillRect(bx - cameraX, by, 50, 50);
                ctx.strokeStyle = "#FFF"; ctx.strokeRect(bx - cameraX + 5, by + 5, 40, 40);
            } else {
                ctx.fillStyle = "#795548"; ctx.fillRect(bx - cameraX, by, 50, 50);
                ctx.fillStyle = "#4caf50"; ctx.fillRect(bx - cameraX, by, 50, 15);
            }
        }
    }

    drawSteve(player.x, player.y);
    document.getElementById("dist").innerText = Math.floor(player.x/50);
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
